# Remote Debugging Clojure Web Applications on Microsoft Azure Websites
Clojure can be used to build web applications that can be deployed on Microsoft Azure Websites. Developing the application locally is a great deal of fun with the awesome REPL. The repl is also a highly effective mean to observe the live process and troubleshoot tricky issues. However, once it is deployed to Azure, there is no longer an easy way to access a REPL to the live application. This is a small helper to gain that REPL access again. It is quite simple, but highly effective at troubleshooting the live application even in the production environment without any performance hit.

**It doesn't require any kind of addition or modification to your existing clojure web application.**

A simple REPL can be started on a Clojure application just by one simple java option `-Dclojure.server.repl="{:port 9000 :accept clojure.core.server/repl}"`. With this, Clojure would automatically start a *Socket REPL* on port *9000*. The trick is to make this REPL accessible somehow on your local machine. That is the purpose of this tool.

**Prerequisites**
* Azure website with a Clojure (Java) Web Application.
* Enable websockets on your azure web site.
* Change bitness of your webapp to 64bit.

## Ensure 64bit and Enable 'web sockets' on your azure website
![alt text](https://github.com/paroda/az-ws-debug/blob/master/docs/images/websocket-enabled.png "")

## Enable Socket REPL in web.config
The actual method of hosting Clojure app can be different from the example shown here. In that case, you may have to do it a bit differently to ensure this option in *JAVA_OPTS*.

```
<httpPlatform
   processPath="%JAVA_HOME%\bin\java.exe"
   arguments="-Djava.net.preferIPv4Stack=true
              -Dclojure.server.repl=&quot;{:port %HTTP_PLATFORM_DEBUG_PORT% :accept clojure.core.server/repl}&quot;
              -cp d:\home\site\wwwroot\src;d:\home\site\wwwroot\lib\*;d:\home\site\wwwroot\resources
              clojure.main
              -e &quot;(do (require (quote my-app.core)) (my-app.core/start))&quot;">
</httpPlatform>
```
Or
```
<httpPlatform>
   <environmentVariables>
      <environmentVariable
         name="JAVA_OPTS"
         value="-Djava.net.preferIPv4Stack=true
                -Dclojure.server.repl=&quot;{:port %HTTP_PLATFORM_DEBUG_PORT% :accept clojure.core.server/repl}&quot;"/>
   </environmentVariables>
</httpPlatform>
```
NOTE: *%HTTP_PLATFORM_DEBUG_PORT%* is a special placeholder which will be replaced with a port internally generated by the *HttpPlatformHandler* module.

Restart your azure website after editing the web.config.

## Gather azure web application connection info
To access the REPL this tool connects to the azure app service scm endpoint and establishes a websocket. It would need the credentials for authentication. You need to obtain those credentials for your azure web application from Azure Portal.

In the Azure Portal, in the *Overview* blade, click *Get publish profile*. This would download a *.PublishSettings* file. Note the *username* and *password* associated with the *MSDeploy* publishMethod.

## Access the remote REPL
